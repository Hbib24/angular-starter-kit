<nz-table
  #table
  [nzData]="items"
  (nzCurrentPageDataChange)="(onCurrentPageDataChange)"
  [nzLoading]="loading"
  [nzScroll]="{ x: scrollX, y: scrollY }"
  [nzBordered]="_options().bordered"
  [nzOuterBordered]="true"
  [nzSimple]="_options().simple"
  [nzTableLayout]="_options().tableLayout"
  [nzPaginationType]="_options().paginationType"
  [nzPaginationPosition]="_options().position"
  [nzShowSizeChanger]="_options().sizeChanger"
  [nzShowPagination]="_options().pagination"
  [nzFooter]="_options().footer ? _options().footer : null"
  [nzTitle]="_options().header ? _options().header : null"
  [nzSize]="_options().size"
  [nzFrontPagination]="false"
  [nzTotal]="totalSize"
  [nzPageIndex]="page"
  (nzPageIndexChange)="onPageChange($event)"
>
  <thead>
    <tr>
      @if (_options().checkbox) {
      <th
        [nzWidth]="'60px'"
        [nzChecked]="checked"
        [nzIndeterminate]="indeterminate"
        (nzCheckedChange)="onAllChecked($event)"
      ></th>
      } @for (col of columns(); track col.key) { @if (!col.hidden) {

      <th
        [nzShowSort]="col.sortFn"
        [nzSortOrder]="col.sortOrder || null"
        [nzSortDirections]="col.sortDirections || []"
        [nzSortFn]="col.sortFn ?? false"
        [nzLeft]="col.fixed == 'left'"
        [nzRight]="col.fixed == 'right'"
        [nzWidth]="col.width ?? getColumnWidth(col)"
      >
        {{ col.label }}
      </th>
      } }
    </tr>
  </thead>

  <tbody>
    @for (row of table.data; let i = $index; track i) {
    <tr>
      @if (_options().checkbox) {
      <td
        [nzChecked]="setOfCheckedId.has(row.id)"
        [nzDisabled]="!(_options().rowSelectable?.(row) ?? true)"
        (nzCheckedChange)="onItemChecked(row.id, $event)"
      ></td>
      } @for (col of columns(); track col.key) { @if (!col.hidden) {

      <td [nzLeft]="col.fixed == 'left'" [nzRight]="col.fixed == 'right'">
        @if (getTemplate(col.key)) {

        <ng-container
          [ngTemplateOutlet]="getTemplate(col.key)"
          [ngTemplateOutletContext]="{ $implicit: { item: row, index: i } }"
        >
        </ng-container>
        } @else {
        <ng-container>
          @if (col.type === 'date') {
          {{ getValue(col.key, row) | date : "dd/MM/yyyy" }}
          } @else if (col.type === 'time') {
          {{ getValue(col.key, row) | date : "HH:mm" }}
          } @else if (col.type === 'datetime') {
          {{ getValue(col.key, row) | date : "dd/MM/yyyy HH:mm" }}
          } @else if(col.format ){
          {{ col.format(getValue(col.key, row), row) }}
          } @else if(col.type === 'currency') {
          <app-currency-display
            [isoCode]="getValue(col.key, row)"
            [displayText]="true"
          ></app-currency-display>
          } @else {
          {{ getValue(col.key, row) }}
          }
        </ng-container>
        }
      </td>
      } }
    </tr>
    }
  </tbody>
</nz-table>
